---
// ThemeToggle.astro
export const prerender = false;
---

<div class="flex justify-center my-3">
  <label class="cursor-pointer flex items-center gap-2">
    <span class="text-sm">🌞</span>
    <input id="theme-toggle" type="checkbox" class="toggle toggle-sm" />
    <span class="text-sm">🌙</span>
  </label>
</div>

<script is:client="load">
  const html = document.documentElement;

  // ✅ 항상 최신 상태를 참조하도록 연결
  window.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("theme-toggle");

    if (!toggle) return;

    const savedTheme = localStorage.getItem("theme") || "pastel";
    html.setAttribute("data-theme", savedTheme);
    toggle.checked = savedTheme === "pastelDark";

    // ✅ 기존 핸들러 제거 후 재연결 (중복 방지)
    toggle.onchange = () => {
      const newTheme = toggle.checked ? "pastelDark" : "pastel";
      html.setAttribute("data-theme", newTheme);
      localStorage.setItem("theme", newTheme);
    };
  });
</script>
